<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Registro de un cliente</title>
  <link rel="stylesheet" title="pink" type="text/css" href="css/estilo.css">
  <script type="text/javascript" src="js/Persona.js"></script>
  <script type="text/javascript" src="js/Storage.js"></script>  
</head>
<body>
<h1>Registro</h1>

<form method="POST" name="formulario" id="formulario" action="javascript:doSubmit();">
  <table border=0 cellpadding=3 cellspacing=4 >
       <tr><td colspan="2" class="titulo">Perfil</td></tr>
       <tr><td class="etiqueta">Cedula</td><td><input type="text" name="cedula" id="cedula"> <input type="button" name="consultar" id="consultar" value="Consultar"></td></tr>
	   <tr><td class="etiqueta">Nombre</td><td><input type="text" name="nombre" id="nombre" ></td></tr>
	   <tr><td class="etiqueta">Sexo</td>
	       <td>
		     <table>
		       <tr>
			     <td id="tdMasc"><input type="radio" name="sexo" value="M" id="sexoMasc"></>M</td>
				 <td id="tdFem"><input type="radio" name="sexo" value="F" id="sexoFem">F</td>
				</tr>
			  </table>
			</td>
		</tr>
	   <tr><td class="titulo" colspan="2"><input class="titulo" type="submit" value="Registrar"></td></tr>	   
	</table>
</form>
</body>
<script>
  var personas;
  var persona;
  function pageLoad(event){
    var cedula=document.getElementById("cedula"); 
    var nombre=document.getElementById("nombre");	
	cedula.addEventListener("focus",doFocus);
    cedula.addEventListener("blur",doBlur); 
	nombre.addEventListener("focus",doFocus);
    nombre.addEventListener("blur",doBlur); 
    var formulario=document.getElementById("formulario");
    formulario.addEventListener("submit",doValidate);
	var consultar=document.getElementById("consultar");	
	consultar.addEventListener("click",doQuery);
	personas = Storage.retrieve("personas");
    if (personas == null){
		personas=[];
		Storage.store("personas",personas);
	}
  }
  function doFocus(event){
    event.target.className="focus";
  }
  function doBlur(event){
    event.target.className="nofocus";
  }
  function doValidate(event){
    var cedula=document.getElementById("cedula"); 
    var nombre=document.getElementById("nombre");
    var sexoMasc=document.getElementById("sexoMasc");	
    var sexoFem=document.getElementById("sexoFem");
	var error=false;
	
	cedula.classList.remove("invalid");
	if (cedula.value.length==0){
		cedula.classList.add("invalid");
		error=true;
	}

	nombre.classList.remove("invalid");
	if (nombre.value.length==0){
		nombre.classList.add("invalid");
		error=true;
	}

	sexoMasc.classList.remove("invalid");
	sexoFem.classList.remove("invalid");
	if ( (!sexoMasc.checked) && (!sexoFem.checked) ){
		sexoMasc.classList.add("invalid");
		sexoFem.classList.add("invalid");
		error=true;
	}
	
	nombre.classList.remove("invalid");
	if (nombre.value.length==0){
		nombre.classList.add("invalid");
		error=true;
	}
	
	if (error){event.preventDefault();}
  }
  function doSubmit(){
    var cedula=document.getElementById("cedula"); 
    var nombre=document.getElementById("nombre");
    var sexoMasc=document.getElementById("sexoMasc");	
    var sexoFem=document.getElementById("sexoFem");
	var sexo=(sexoMasc.checked)? "M": "F";
	persona = new Persona(cedula.value,nombre.value,sexo);
	personas.push(persona);
	Storage.store("personas",personas);
	window.alert("Data sent: "+persona.completo("-"));
    var formulario=document.getElementById("formulario");
    formulario.reset();	
  }
  function doQuery(){
    var cedula=document.getElementById("cedula");
	cedula.classList.remove("invalid");
	persona = personas.find(function(p){return p.cedula==cedula.value; });
    if (persona != null){
		showPersona(persona);
	}
	else{
		cedula.classList.add("invalid");	
	}
  }
 function showPersona(persona){
    var cedula=document.getElementById("cedula"); 
    var nombre=document.getElementById("nombre");
    var sexoMasc=document.getElementById("sexoMasc");	
    var sexoFem=document.getElementById("sexoFem");
	
	cedula.value = persona.cedula;
	nombre.value = persona.nombre;
	if(persona.sexo=="M"){
	  sexoMasc.checked=true;
	}
	else{
	  sexoFem.checked=true;
	}
}  
  
  
  document.addEventListener("DOMContentLoaded",pageLoad)
</script>
</html>
